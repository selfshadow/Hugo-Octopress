!function(a){a.bigfoot=function(b){function c(b,c){var d,e,f,g;b.each(function(){var b=a(this);f="#"+b.attr("href").split("#")[1],d=b.closest("sup"),e=b.find("sup"),d.length>0?(g=(d.attr("id")||"")+(b.attr("id")||""),c.push(d.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f}))):e.length>0?(g=(e.attr("id")||"")+(b.attr("id")||""),c.push(b.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f}))):(g=b.attr("id")||"",c.push(b.attr({"data-footnote-backlink-ref":g,"data-footnote-ref":f})))})}function d(a){if(a.is(":empty")||0==a.children(":not(.footnote-print-only)").length){var b=a.parent();"delete"===k.actionOriginalFN.toLowerCase()?a.remove():a.addClass("footnote-print-only"),d(b)}else if(a.children(":not(.footnote-print-only)").length==a.children("hr:not(.footnote-print-only)").length){var b=a.parent();"delete"===k.actionOriginalFN.toLowerCase()?a.remove():(a.children("hr").addClass("footnote-print-only"),a.addClass("footnote-print-only")),d(b)}}function e(a,b){b.indexOf(" ")>=0&&(b=b.trim().replace(/ +/g,"|").replace(/(.*)/g,"($1)"));var c="(s|&nbsp;)*<s*a[^#<]*#"+b+"[^>]*>(.*?)<s*/s*a>",d=new RegExp(c,"g");return a.replace(d,"").replace("[]","")}function f(a,b,c){for(var d,e,f=new RegExp("{{"+b+":([^}]*)}}","g");d=f.exec(a);)d[1]&&(e=c.attr(d[1])||"",a=a.replace("{{"+b+":"+d[1]+"}}",e));return a}function g(b,c){return b=b||".footnote-content",c=c||k.popoverDeleteDelay,a(b).each(function(){var b=a('.footnote-button[data-footnote-identifier="'+a(this).attr("data-footnote-identifier")+'"]'),d=a(this);b.hasClass("changing")||(b.removeClass("active hover-instantiated click-instantiated").addClass("changing"),d.removeClass("active").addClass("disapearing"),setTimeout(function(){d.remove(),b.removeClass("changing")},c))}),a(b.replace(".footnote-content",".footnote-button"))}function h(a,b){b=b||.5;var c=a.find(".tooltip");c.length>0&&c.css({left:100*b+"%"})}function i(b){var c=parseFloat(b.outerWidth()),d=parseFloat(b.outerHeight()),e=j(),f=b.offset().top-a(window).scrollTop()+d/2,g=b.offset().left+c/2;return{topRoom:f,bottomRoom:e.height-f,leftRoom:g,rightRoom:e.width-g,leftRelative:g/e.width,topRelative:f/e.height}}function j(){var a=document.createElement("div");a.style.cssText="position: fixed;top: 0;left: 0;bottom: 0;right: 0;",document.documentElement.insertBefore(a,document.documentElement.firstChild);var b={width:a.offsetWidth,height:a.offsetHeight};return document.documentElement.removeChild(a),b}var k=a.extend({actionOriginalFN:"hide",activateOnHover:!1,allowMultipleFN:!1,appendPopoversTo:void 0,deleteOnUnhover:!1,hoverDelay:250,popoverDeleteDelay:500,popoverCreateDelay:100,positionNextToBlock:!0,positionContent:!0,preventPageScroll:!0,scope:!1,contentMarkup:'<aside class="footnote-content bottom"data-footnote-identifier="{{FOOTNOTENUM}}" alt="Footnote {{FOOTNOTENUM}}"><div class="footnote-main-wrapper"><div class="footnote-content-wrapper">{{FOOTNOTECONTENT}}</div></div><div class="tooltip"></div></aside>',buttonMarkup:'<a href="#" class="footnote-button" data-footnote-identifier="{{FOOTNOTENUM}}" alt="See Footnote {{FOOTNOTENUM}}" rel="footnote"data-footnote-content="{{FOOTNOTECONTENT}}"><span class="footnote-circle" data-footnote-identifier="{{FOOTNOTENUM}}"></span><span class="footnote-circle"></span><span class="footnote-circle"></span></a>'},b),l=function(){var b;b=k.scope?k.scope+' a[href*="#"]':'a[href*="#"]';var g,h,i=a(b).filter(function(){var b=a(this),c=b.attr("rel");return c&&"null"!=c||(c=""),(b.attr("href")+c).match(/(fn|footnote|note)[:\-_\d]/gi)&&b.closest("[class*=footnote]:not(a):not(sup)").length<1}),j=[],l=[],m=[];c(i,l),a(l).each(function(){g=a(this).attr("data-footnote-ref").replace(":","\\:"),h=a(g).closest("li"),h.length>0&&(j.push(h),m.push(this))});for(var n=0;n<j.length;n++){var o,p=e(a(j[n]).html().trim(),a(m[n]).data("footnote-backlink-ref")).replace(/"/g,"&quot;").replace(/&lt;/g,"&ltsym;").replace(/&gt;/g,"&gtsym;"),q=+(n+1),r="";0!==p.indexOf("<")&&(p="<p>"+p+"</p>"),r=k.buttonMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,q).replace(/\{\{FOOTNOTECONTENT\}\}/g,p),r=f(r,"SUP",a(m[n])),r=f(r,"FN",a(j[n])),o=a(r).insertAfter(a(m[n]));var s=a(j[n]).parent();switch(k.actionOriginalFN.toLowerCase()){case"delete":a(m[n]).remove(),a(j[n]).remove(),d(s);break;case"hide":a(m[n]).addClass("footnote-print-only"),a(j[n]).addClass("footnote-print-only"),d(s)}}},m=function(b){if(k.activateOnHover){var c=a(b.target).closest(".footnote-button"),d='[data-footnote-identifier="'+c.attr("data-footnote-identifier")+'"]';if(c.hasClass("active"))return;if(c.addClass("hover-instantiated"),!k.allowMultipleFN){var e=".footnote-content:not("+d+")";g(e)}p(".footnote-button"+d).addClass("hover-instantiated")}},n=function(b){var c=a(b.target),d=c.closest(".footnote-button");$nearFootnote=c.closest(".footnote-content"),d.length>0?(b.preventDefault(),o(d)):$nearFootnote.length<1&&a(".footnote-content").length>0&&g()},o=function(a){a.blur();var b='data-footnote-identifier="'+a.attr("data-footnote-identifier")+'"';a.hasClass("changing")||(a.hasClass("active")?k.allowMultipleFN?g(".footnote-content["+b+"]"):g():(a.addClass("changing"),setTimeout(function(){a.removeClass("changing")},k.popoverCreateDelay),p(".footnote-button["+b+"]"),a.addClass("click-instantiated"),k.allowMultipleFN||g(".footnote-content:not(["+b+"])")))},p=function(b){if(b=b||".footnote-button",k.allowMultipleFN)var c=a(b).closest(".footnote-button");else var c=a(b+":first").closest(".footnote-button");c.each(function(){var b=a(this);try{var c=k.contentMarkup.replace(/\{\{FOOTNOTENUM\}\}/g,b.attr("data-footnote-identifier")).replace(/\{\{FOOTNOTECONTENT\}\}/g,b.attr("data-footnote-content").replace(/&gtsym;/,"&gt;").replace(/&ltsym;/,"&lt;"));c=f(c,"BUTTON",b)}finally{k.appendPopoversTo?$content=a(c).appendTo(k.appendPopoversTo+":first"):($nearestBlock=b.closest("p, div, pre, li, ul, section, article, main, aside"),$siblingFootnote=$nearestBlock.siblings(".footnote-content:last"),$content=$siblingFootnote.length>0?a(c).insertAfter($siblingFootnote):a(c).insertAfter($nearestBlock)),$content.attr("data-bigfoot-max-height",$content.height()),s(),b.addClass("active"),$content.find(".footnote-content-wrapper").bindScrollHandler()}});var d=a(b.replace(".footnote-button",".footnote-content"));return setTimeout(function(){d.addClass("active")},k.popoverCreateDelay),d};a.fn.bindScrollHandler=function(){k.preventPageScroll&&a(this).on("DOMMouseScroll mousewheel",function(b){var c=a(this),d=c.scrollTop(),e=c[0].scrollHeight,f=parseInt(c.css("height")),g=c.closest(".footnote-content");if(c.scrollTop()>0&&c.scrollTop()<10&&g.addClass("scrollable"),g.hasClass("scrollable")){var h="DOMMouseScroll"==b.type?-40*b.originalEvent.detail:b.originalEvent.wheelDelta,i=h>0,j=function(){return b.stopPropagation(),b.preventDefault(),b.returnValue=!1,!1};return!i&&-h>e-f-d?(c.scrollTop(e),g.addClass("fully-scrolled"),j()):i&&h>d?(c.scrollTop(0),g.removeClass("fully-scrolled"),j()):(g.removeClass("fully-scrolled"),void 0)}})};var q=function(b){k.deleteOnUnhover&&k.activateOnHover&&setTimeout(function(){a(b.target).closest(".footnote-content, .footnote-button");a(".footnote-button:hover, .footnote-content:hover").length<1&&g()},k.hoverDelay)},r=function(a){27==a.keyCode&&g()},s=function(){k.positionContent&&a(".footnote-content").each(function(){var b=a(this),c='data-footnote-identifier="'+b.attr("data-footnote-identifier")+'"',d=(b.find(".footnote-content-wrapper"),a(".footnote-button["+c+"]")),e=i(d),f=parseFloat(b.css("width")),g=parseFloat(b.css("margin-top")),j=+b.attr("data-bigfoot-max-height"),k=2*g+j,l=1e4;e.bottomRoom<k&&e.topRoom>e.bottomRoom?(b.css({top:"auto",bottom:e.bottomRoom+"px"}).addClass("top").removeClass("bottom"),l=e.topRoom-g-15,b.css({"transform-origin":100*e.leftRelative+"% 100%"})):(b.css({bottom:"auto",top:e.topRoom+"px"}).addClass("bottom").removeClass("top"),l=e.bottomRoom-g-15,b.css({"transform-origin":100*e.leftRelative+"% 0%"})),b.find(".footnote-content-wrapper").css({"max-height":Math.min(l,j)+"px"}),b.css({left:e.leftRoom-e.leftRelative*f+"px"}),h(b,e.leftRelative),parseInt(b.css("height"))<b.find(".footnote-content-wrapper")[0].scrollHeight&&b.addClass("scrollable")})},t=function(a,b){var c=k[a];return k[a]=b,c},u=function(a){return k[a]};return a(document).ready(function(){l(),a(document).on("mouseenter",".footnote-button",m),a(document).on("touchend click",n),a(document).on("mouseout",".hover-instantiated",q),a(document).on("keyup",r),a(window).on("scroll resize",s)}),{close:function(a,b){return g(a,b)},activate:function(a){return p(a)},reposition:function(){return s()},getSetting:function(a){return u(a)},updateSetting:function(a,b){return t(a,b)}}}}(jQuery);